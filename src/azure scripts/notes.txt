#make sure you have the Az powershell module installed. Check by using 'Get-InstalledModule -Name Az' and make sure version >= 5.9.0
# https://learn.microsoft.com/en-us/powershell/azure/install-az-ps?view=azps-9.0.1
#Guide: https://learn.microsoft.com/en-us/azure/aks/learn/quick-kubernetes-deploy-powershell








#TROUBLE-SHOOTING: if your AKS cluster doesn't have permissions to pull images from your ACR. you may need to manually add the permission for the cluster's managed identity
#Get $spID from the managed identity associated with your AKS cluster
$resourceID = (Get-AzContainerRegistry -ResourceGroupName $resourceGroup -Name $containerRegistryName).Id
New-AzRoleAssignment -ObjectId $spID -Scope $resourceID -RoleDefinitionName AcrPull
